<!DOCTYPE html>
<html>
<head>
  <title>CPA Client</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <link href="css/bootstrap.min.css" rel="stylesheet">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
  <![endif]-->
</head>
<body>
<div class="container">

  <h1>CPA WebFlow demo</h1>

  <!--<div class="btn btn-default" id="power_btn"><i class='glyphicon glyphicon-off'></i></div>-->
  <!--<div class="btn btn-default" id="reset_btn"><i class='glyphicon glyphicon-trash'></i></div>-->
  <!--<div class="panel panel-default">-->
    <!--<div id="display-title" class="panel-heading"></div>-->
    <!--<div id="display" class="panel-body">initializing...</div>-->
  <!--</div>-->
  <!--<div id="console"><h1>Console</h1></div>-->



  <!-- Nav tabs -->
  <ul class="nav nav-tabs" id="tabs">
    <li class="active"><a href="#bbc1" data-toggle="tab">BBC 1</a></li>
    <!--<li><a href="#bbc2" data-toggle="tab">BBC 2</a></li>-->
  </ul>

  <!-- Tab panes -->
  <div class="tab-content">
    <div class="tab-pane active" id="bbc1"><h2>BBC TWO: On TV</h2><address>Horizon - Man on Mars</address></div>
    <div class="tab-pane" id="bbc2"></div>
  </div>

  <div class="btn btn-default" id="tag-btn"><i class='glyphicon glyphicon-tag'></i> TAG</div>

</div>



<script type="text/javascript" src="js/lib/jquery.min.js"></script>
<script type="text/javascript" src="js/lib/jquery.storageapi.min.js"></script>
<script type="text/javascript" src="js/lib/bootstrap.min.js"></script>
<script type="text/javascript" src="js/lib/ejs_0.9_alpha_1_production.js"></script>

<script type="text/javascript" src="js/lib/underscore.min.js"></script>
<script type="text/javascript" src="js/lib/machina.min.js"></script>

<script type="text/javascript" src="js/lib/logger.min.js"></script>
<script type="text/javascript" src="js/logger.js"></script>

<script type="text/javascript" src="js/config.js"></script>
<script type="text/javascript" src="js/storage.js"></script>
<script type="text/javascript" src="js/request-helper.js"></script>
<script type="text/javascript" src="js/cpa-protocol.js"></script>
<script type="text/javascript" src="js/radiotag-protocol.js"></script>
<script type="text/javascript" src="js/app-fsm.js"></script>


<script>
  deparam = function (querystring) {
    // remove any preceding url and split
    querystring = querystring.substring(querystring.indexOf('?')+1).split('&');
    var params = {}, pair, d = decodeURIComponent, i;
    // march and parse
    for (i = querystring.length; i > 0;) {
      pair = querystring[--i].split('=');
      params[d(pair[0])] = d(pair[1]);
    }

    return params;
  };//--  fn  deparam

  $(function () {
    console.log(deparam(window.location.hash));
  });


  $('#tag-btn').click(function() {
    currentTab = $('#tabs > li.active');

    var ap = "http://localhost:5000";

    var params = $.param({
      response_type: 'token',
      client_id: 'abc123',
      redirect_uri: 'http://local.ebu.io:8000/client/cpa-webflow.html',
      state: 'callback'
    });
//    r = requestHelper.postForm('http://localhost:5000/oauth/token', $.param(body))
//            .complete(function (x) {
//              console.log(x);
//            });
//
//    $('<form action="http://localhost:5000/oauth/token" method="POST">' +
//            '<input type="hidden" name="client_id" value="abc123">' +
//            '<input type="hidden" name="response_type" value="token">' +
//            '<input type="hidden" name="redirect_uri" value="http://local.ebu.io:8000/client/cpa-webflow.html">' +
//            '</form>').submit();

    window.location.replace(ap+"/dialog/authorize?"+params);

  });

</script>
</body>
</html>
